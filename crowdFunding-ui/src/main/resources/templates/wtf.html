<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Krajee JQuery Plugins - © Kartik</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          crossorigin="anonymous">
    <link href="test/css/fileinput.css" media="all" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" crossorigin="anonymous">
    <link href="test/themes/explorer-fas/theme.css" media="all" rel="stylesheet" type="text/css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
    <script src="test/js/plugins/piexif.js" type="text/javascript"></script>
    <script src="test/js/plugins/sortable.js" type="text/javascript"></script>
    <script src="test/js/fileinput.js" type="text/javascript"></script>
    <script src="test/js/locales/fr.js" type="text/javascript"></script>
    <script src="test/themes/fas/theme.js" type="text/javascript"></script>
    <script src="test/themes/explorer-fas/theme.js" type="text/javascript"></script>
</head>
<body>
<div>
    <div class="file-loading">
        <input id="upload-video" name="upload-video[]" type="file" multiple>
    </div>
</div>
<script>
    $("#upload-video").fileinput({
        theme: 'fas',
        uploadUrl: '/resumable/file/upload',
        enableResumableUpload: true,            //支持断点续传
        allowedFileTypes: ['video'],  //设置其一就够了
        //overwriteInitial: false,
        resumableUploadOptions: {
            //testUrl: "/site/test-file-chunks",续传功能的开发
            chunkSize: 256 // 256KB
        },
        minFileSize: 1024 * 2,
        maxFileSize: 1024 * 200,
        maxFileCount: 1,
        uploadExtraData: {userToken: 'fifteenthofjuly'}
    });
    $("#upload-video").on('fileuploaded', function (event, fileId) {
        var file_id = fileId.slice(19);  //这个返回的fileId比原始的fileId前面多追加了"thumb-upload-video-"
        $.ajax({
            type: "GET",
            url: "/complete/chunk/file",
            data: {"fileId": file_id},
            dataType: "json",
            success: function (response) {
                if (response.status === 'FAILED') {
                    console.log("文件上传失败")
                } else {
                    var url = response.data;
                    console.log("文件上传成功，文件的地址为" + url)
                }

            }
        })
    });
    $("#upload-video").on('filesuccessremove', function (event, id) {
        //productVideo.delete(id);
    });
</script>
</body>
</html>